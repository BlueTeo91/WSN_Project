///////////////////////////////////////////////////////////////////////////////
//                                                                            /
//                                                      15/Oct/2012  16:29:13 /
// IAR ANSI C/C++ Compiler V5.50.7.22081/W32 EVALUATION for ARM               /
// Copyright (C) 1999-2010 IAR Systems AB.                                    /
//                                                                            /
//    Cpu mode     =  thumb                                                   /
//    Endian       =  little                                                  /
//    Source file  =  C:\Documents and Settings\Administrator\My              /
//                    Documents\MyWirelessApp Demo Non Beacon                 /
//                    (Coordinator)\MyWirelessApp Demo Non Beacon             /
//                    (Coordinator)\PLM\Source\Sound\Sound.c                  /
//    Command line =  "C:\Documents and Settings\Administrator\My             /
//                    Documents\MyWirelessApp Demo Non Beacon                 /
//                    (Coordinator)\MyWirelessApp Demo Non Beacon             /
//                    (Coordinator)\PLM\Source\Sound\Sound.c" -D              /
//                    gMacStandAlone_d=1 -D gSAPMessagesEnableLlc_d=0 -D      /
//                    gZtcIncluded_d=0 -D gTargetMC1322xNCB=1 --preprocess    /
//                    "C:\Documents and Settings\Administrator\My             /
//                    Documents\MyWirelessApp Demo Non Beacon                 /
//                    (Coordinator)\MyWirelessApp Demo Non Beacon             /
//                    (Coordinator)\Debug\List\" -lC "C:\Documents and        /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\Debug\List\" -lB "C:\Documents and        /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\Debug\List\" --diag_suppress              /
//                    Pe014,Pe001,Pe991,Pa039,Pe520 -o "C:\Documents and      /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\Debug\Obj\" --no_cse --no_unroll          /
//                    --no_inline --no_code_motion --no_tbaa --no_clustering  /
//                    --no_scheduling --debug --endian=little                 /
//                    --cpu=ARM7TDMI-S --fpu=None --dlib_config "C:\Program   /
//                    Files\IAR Systems\Embedded Workbench 5.4                /
//                    Evaluation\arm\INC\DLib_Config_Normal.h" -I             /
//                    "C:\Documents and Settings\Administrator\My             /
//                    Documents\MyWirelessApp Demo Non Beacon                 /
//                    (Coordinator)\MyWirelessApp Demo Non Beacon             /
//                    (Coordinator)\MacPhy\Interface\" -I "C:\Documents and   /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\Application\Init\" -I "C:\Documents and   /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\Application\Interface\" -I "C:\Documents  /
//                    and Settings\Administrator\My Documents\MyWirelessApp   /
//                    Demo Non Beacon (Coordinator)\MyWirelessApp Demo Non    /
//                    Beacon (Coordinator)\Application\Configure\" -I         /
//                    "C:\Documents and Settings\Administrator\My             /
//                    Documents\MyWirelessApp Demo Non Beacon                 /
//                    (Coordinator)\MyWirelessApp Demo Non Beacon             /
//                    (Coordinator)\Application\UartUtil\" -I "C:\Documents   /
//                    and Settings\Administrator\My Documents\MyWirelessApp   /
//                    Demo Non Beacon (Coordinator)\MyWirelessApp Demo Non    /
//                    Beacon (Coordinator)\Application\Source\" -I            /
//                    "C:\Documents and Settings\Administrator\My             /
//                    Documents\MyWirelessApp Demo Non Beacon                 /
//                    (Coordinator)\MyWirelessApp Demo Non Beacon             /
//                    (Coordinator)\SSM\TS\Interface\" -I "C:\Documents and   /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\SSM\TS\Source\" -I "C:\Documents and      /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\SSM\ZTC\Interface\" -I "C:\Documents and  /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\SSM\ZTC\Source\" -I "C:\Documents and     /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\PLM\Interface\" -I "C:\Documents and      /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\PLM\LibInterface\" -I "C:\Documents and   /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\PLM\Source\Display\" -I "C:\Documents     /
//                    and Settings\Administrator\My Documents\MyWirelessApp   /
//                    Demo Non Beacon (Coordinator)\MyWirelessApp Demo Non    /
//                    Beacon (Coordinator)\PLM\Source\Keyboard\" -I           /
//                    "C:\Documents and Settings\Administrator\My             /
//                    Documents\MyWirelessApp Demo Non Beacon                 /
//                    (Coordinator)\MyWirelessApp Demo Non Beacon             /
//                    (Coordinator)\PLM\Source\NVM\" -I "C:\Documents and     /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\PLM\Source\TMR\" -I "C:\Documents and     /
//                    Settings\Administrator\My Documents\MyWirelessApp Demo  /
//                    Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon  /
//                    (Coordinator)\PLM\Source\UART\" -I "C:\Program          /
//                    Files\IAR Systems\Embedded Workbench 5.4                /
//                    Evaluation\arm\INC\" --interwork --cpu_mode thumb -On   /
//    List file    =  C:\Documents and Settings\Administrator\My              /
//                    Documents\MyWirelessApp Demo Non Beacon                 /
//                    (Coordinator)\MyWirelessApp Demo Non Beacon             /
//                    (Coordinator)\Debug\List\Sound.s                        /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME Sound



        END
// C:\Documents and Settings\Administrator\My Documents\MyWirelessApp Demo Non Beacon (Coordinator)\MyWirelessApp Demo Non Beacon (Coordinator)\PLM\Source\Sound\Sound.c
//    1 /************************************************************************************
//    2 * MC1322x Buzzer routines
//    3 *
//    4 * Copyright (c) 2007, Freescale, Inc. All rights reserved.
//    5 *
//    6 *
//    7 * No part of this document must be reproduced in any form - including copied,
//    8 * transcribed, printed or by any electronic means - without specific written
//    9 * permission from Freescale Semiconductor.
//   10 *
//   11 *****************************************************************************/
//   12 #include "EmbeddedTypes.h"
//   13 #include "AppToPlatformConfig.h"
//   14 #include "Sound.h"
//   15 #include "Timer.h"
//   16 #include "I2C_Interface.h"
//   17 #include "GPIO_Interface.h"
//   18 #if gHaveBuzzer_c
//   19 /************************************************************************************
//   20 *************************************************************************************
//   21 * Private macros
//   22 *************************************************************************************
//   23 ************************************************************************************/
//   24 #define mBeepFreqinKHz_c  4
//   25 #define mToggleCompareValue_c  (SYSTEM_CLOCK/(mBeepFreqinKHz_c * 2))
//   26 #define  mSLAVE_DEV_ADDRESS_c  0x50
//   27 #define  mVREG_CMD_c           0x11
//   28 #define  gGpioBeepTimer_c     ((GpioPin_t)((uint8_t)gGpioPin8_c + (uint8_t)gBeepTimer_c))
//   29 /************************************************************************************
//   30 *************************************************************************************
//   31 * Private type definitions
//   32 
//   33 *************************************************************************************
//   34 ************************************************************************************/
//   35 
//   36 /************************************************************************************
//   37 *************************************************************************************
//   38 * Private prototypes
//   39 *************************************************************************************
//   40 ************************************************************************************/
//   41 
//   42 static void BuzzerTimerCallBack(TmrNumber_t tmrNumber);
//   43 static void Llc_VolumeInit(void);
//   44 static void Llc_VolumeSet(uint8_t volume);
//   45 /************************************************************************************
//   46 *************************************************************************************
//   47 * Public memory declarations
//   48 *************************************************************************************
//   49 ************************************************************************************/
//   50 
//   51 /************************************************************************************
//   52 *************************************************************************************
//   53 * Private memory declarations
//   54 *************************************************************************************
//   55 ************************************************************************************/
//   56 uint32_t mMsCounter;
//   57 uint32_t mBeepDuration;
//   58 
//   59 /************************************************************************************
//   60 *************************************************************************************
//   61 * Public functions
//   62 *************************************************************************************
//   63 ************************************************************************************/
//   64 
//   65 bool_t BuzzerInit(void)
//   66 {
//   67   TmrConfig_t tmrConfig;
//   68   TmrStatusCtrl_t tmrStatusCtrl;
//   69   TmrComparatorStatusCtrl_t tmrComparatorStatusCtrl;
//   70   /* Enable hw timer 1 */
//   71   TmrEnable(gBeepTimer_c);
//   72   /* Don't stat the timer yet */ 
//   73   if (gTmrErrNoError_c != TmrSetMode(gBeepTimer_c, gTmrNoOperation_c)) /*set timer mode no operation*/
//   74   {
//   75     return FALSE;
//   76   }
//   77   /* Register the callback executed when an interrupt occur */
//   78   if(gTmrErrNoError_c != TmrSetCallbackFunction(gBeepTimer_c, gTmrComp1Event_c, BuzzerTimerCallBack))
//   79   {
//   80     return FALSE;
//   81   }
//   82   tmrStatusCtrl.uintValue = 0x0000;
//   83   tmrStatusCtrl.bitFields.OEN = 1;    //output enable
//   84   if (gTmrErrNoError_c != TmrSetStatusControl(gBeepTimer_c, &tmrStatusCtrl))
//   85   {
//   86     return FALSE;
//   87   }  
//   88   tmrComparatorStatusCtrl.uintValue = 0x0000;
//   89   tmrComparatorStatusCtrl.bitFields.TCF1EN = TRUE; /* Enable Compare 1 interrupt */
//   90   if (gTmrErrNoError_c != TmrSetCompStatusControl(gBeepTimer_c, &tmrComparatorStatusCtrl))
//   91   {
//   92     return FALSE;
//   93   }
//   94   tmrConfig.tmrOutputMode = gTmrToggleOF_c; 
//   95   tmrConfig.tmrCoInit = FALSE;  /*co-chanel counter/timers can not force a re-initialization of this counter/timer*/
//   96   tmrConfig.tmrCntDir = FALSE;  /*count-up*/
//   97   tmrConfig.tmrCntLen = TRUE;  /*count until compare*/
//   98   tmrConfig.tmrCntOnce = FALSE;   /*count repeatedly*/
//   99   tmrConfig.tmrSecondaryCntSrc = gTmrSecondaryCnt0Input_c;    /*secondary count source not needed*/
//  100   tmrConfig.tmrPrimaryCntSrc = gTmrPrimaryClkDiv1_c;    /*primary count source is IP BUS clock divide by 1 prescaler*/
//  101   if (gTmrErrNoError_c != TmrSetConfig(gBeepTimer_c, &tmrConfig))  /*set timer configuration */
//  102   {
//  103     return FALSE;
//  104   }
//  105   /* Config timer to raise interrupts each 0.1 ms */
//  106   SetComp1Val(gBeepTimer_c, mToggleCompareValue_c);
//  107   /* Config timer to start from 0 after compare event */
//  108   SetLoadVal(gBeepTimer_c, 0);
//  109   I2c_Init();
//  110   Gpio_SetPinFunction(gGpioBeepTimer_c, gGpioAlternate1Mode_c); 
//  111   Gpio_SetPinFunction(gGpioPin12_c, gGpioAlternate1Mode_c);
//  112   Gpio_SetPinFunction(gGpioPin13_c, gGpioAlternate1Mode_c);
//  113   return TRUE;
//  114 }
//  115 
//  116 /***********************************************************************************/
//  117 
//  118 bool_t BuzzerBeep (void) 
//  119 {
//  120   if( gBeepDurationInMs_c == 0 )
//  121     return FALSE;
//  122   if (gTmrErrNoError_c != TmrSetMode(gBeepTimer_c, gTmrNoOperation_c)) /*set timer mode no operation*/
//  123   {
//  124     return FALSE;
//  125   }
//  126   mMsCounter = 0;
//  127   mBeepDuration = gBeepDurationInMs_c;
//  128   SetCntrVal(gBeepTimer_c, 0) ; /*clear counter*/
//  129   Llc_VolumeInit();
//  130   Llc_VolumeSet(gBeepVolumeInPrc_c);   
//  131   if (gTmrErrNoError_c != TmrSetMode(gBeepTimer_c, gTmrCntRiseEdgPriSrc_c))
//  132   {
//  133     return FALSE;
//  134   }
//  135   return TRUE;
//  136 }
//  137 
//  138 /************************************************************************************
//  139 *************************************************************************************
//  140 * Private functions
//  141 *************************************************************************************
//  142 ************************************************************************************/
//  143 
//  144 static void BuzzerTimerCallBack(TmrNumber_t tmrNumber)
//  145 {
//  146   mMsCounter++;
//  147   if(mMsCounter >= mBeepFreqinKHz_c<<1)
//  148   {
//  149     mMsCounter = 0;
//  150     mBeepDuration --;
//  151     if(mBeepDuration == 0)
//  152     {
//  153       TmrSetMode(gBeepTimer_c, gTmrNoOperation_c);    //stop timer  
//  154     }
//  155   }
//  156 }
//  157 
//  158 /***********************************************************************************/
//  159 
//  160 static void Llc_VolumeInit(void)
//  161 {
//  162   I2cConfig_t i2cConfig;
//  163   I2c_Enable();
//  164   i2cConfig.i2cBroadcastEn = FALSE;
//  165   i2cConfig.freqDivider   = 0x20;
//  166   i2cConfig.saplingRate   = 0x01;
//  167   i2cConfig.slaveAddress   = 0x00;
//  168   i2cConfig.i2cInterruptEn = FALSE; 
//  169   I2c_SetConfig(&i2cConfig);
//  170 }
//  171 
//  172 /***********************************************************************************/
//  173 
//  174 static void Llc_VolumeSet(uint8_t volume)
//  175 {
//  176   uint8_t buffer[2];
//  177   if(volume > (uint8_t)100)
//  178   {
//  179     volume = 100; /* Limit volume to 100% */
//  180   }
//  181   /* Scale down the volume value to 0 - 31 range */
//  182   volume = (volume * 31) / 100;
//  183   buffer[0] = mVREG_CMD_c;
//  184   buffer[1] = (volume & 0xFF) << 3;
//  185   I2c_SendData(mSLAVE_DEV_ADDRESS_c, &buffer[0], 2, gI2cMstrReleaseBus_c);
//  186 }
//  187 
//  188 #endif 
//  189  
//  190  
// 
// 
// 0 bytes of memory
//
//Errors: none
//Warnings: none
